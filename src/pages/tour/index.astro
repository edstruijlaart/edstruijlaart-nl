---
export const prerender = false;

import BaseLayout from '../../layouts/BaseLayout.astro';
import SectionHeading from '../../components/ui/SectionHeading.astro';
import ShowList from '../../components/sections/ShowList.astro';
import Button from '../../components/ui/Button.astro';
import { Image } from 'astro:assets';
import { tours } from '../../data/tours';
import huiskamerImg from '../../assets/photos/ed-struijlaart-lachend-gitaar.jpg';

// ISR: herrender deze pagina elk uur
Astro.response.headers.set('CDN-Cache-Control', 'public, max-age=3600, s-maxage=3600, stale-while-revalidate=86400');

// Import theater posters
const posterImages = import.meta.glob<{ default: ImageMetadata }>('../../assets/theater/*.{jpg,jpeg,png}', { eager: true });

function getPosterImage(filename: string): ImageMetadata | undefined {
  const key = Object.keys(posterImages).find(k => k.endsWith(filename));
  return key ? posterImages[key].default : undefined;
}

const currentTour = tours.find(t => t.current);
const archivedTours = tours.filter(t => !t.current);
---

<BaseLayout
  title="Theater & Shows"
  description="Bekijk de agenda van Ed Struijlaart. Theatershow Gitaarmannen 3: John Mayer, huiskamerconcerten en meer."
>
  <!-- 1. AGENDA — bovenaan, want dit is wat bezoekers zoeken -->
  <section class="pt-24 lg:pt-32 pb-20">
    <div class="mx-auto max-w-[1200px] px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h1 class="font-[var(--font-display)] text-4xl lg:text-5xl">Shows & Agenda</h1>
        <p class="mt-4 text-lg text-[var(--fg-muted)] max-w-2xl mx-auto">
          Bekijk waar Ed binnenkort speelt en bestel direct je tickets.
        </p>
      </div>
      <ShowList />
    </div>
  </section>

  <!-- 2. THEATERPRODUCTIES — poster grid -->
  <section class="py-20" style="background-color: var(--bg-surface);">
    <div class="mx-auto max-w-[1200px] px-4 sm:px-6 lg:px-8">
      <SectionHeading
        title="Theaterproducties"
        subtitle="Vier producties, meer dan 180 voorstellingen door heel Nederland"
      />

      <!-- Poster Grid -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8">
        {tours.map(tour => {
          const poster = getPosterImage(tour.posterImage);
          return (
            <a
              href={`/tour/${tour.slug}/`}
              class="group block"
            >
              {/* Poster */}
              <div class="relative rounded-lg overflow-hidden" style="box-shadow: var(--shadow-card);">
                {poster && (
                  <div class="aspect-[3/4] overflow-hidden">
                    <Image
                      src={poster}
                      alt={`${tour.title}${tour.subtitle ? ': ' + tour.subtitle : ''} theaterposter`}
                      width={400}
                      height={533}
                      class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                      loading="lazy"
                    />
                  </div>
                )}
                {/* Current badge */}
                {tour.current && (
                  <div class="absolute top-3 right-3">
                    <span class="inline-block px-2 py-1 rounded-full text-xs font-medium bg-[var(--color-gold)] text-white shadow-lg">
                      Nu in theater
                    </span>
                  </div>
                )}
              </div>
              {/* Title + year below poster */}
              <div class="mt-3 text-center">
                <p class="font-[var(--font-display)] text-base sm:text-lg group-hover:text-[var(--color-gold)] transition-colors duration-300">
                  {tour.title}{tour.subtitle ? `: ${tour.subtitle}` : ''}
                </p>
                <p class="text-sm text-[var(--fg-muted)] mt-0.5">{tour.year}</p>
              </div>
            </a>
          );
        })}
      </div>
    </div>
  </section>

  <!-- 3. HUISKAMERCONCERTEN — onderaan, met foto en info -->
  <section class="py-20 md:py-28 relative overflow-hidden" style="background-color: var(--color-dark-bg);">
    <div class="absolute bottom-0 right-0 w-96 h-96 rounded-full blur-3xl opacity-5" style="background-color: var(--color-gold);"></div>

    <div class="relative mx-auto max-w-[1200px] px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        {/* Image with stat badge */}
        <div class="relative">
          <div class="rounded-2xl overflow-hidden">
            <Image
              src={huiskamerImg}
              alt="Ed Struijlaart tijdens een huiskamerconcert"
              width={600}
              class="w-full h-auto"
              loading="lazy"
            />
          </div>
          <div class="absolute -bottom-4 -right-4 md:bottom-4 md:right-4 bg-[var(--color-gold)] text-white rounded-2xl px-6 py-4 text-center" style="box-shadow: 0 8px 30px rgba(184, 134, 11, 0.3);">
            <span class="block text-3xl font-bold">600+</span>
            <span class="block text-sm opacity-90">huiskamerconcerten</span>
          </div>
        </div>

        {/* Content */}
        <div>
          <span class="inline-block px-3 py-1 rounded-full text-sm font-medium bg-[var(--color-gold)]/20 text-[var(--color-gold)] mb-6">
            Huiskamerconcert
          </span>
          <h2 class="font-[var(--font-display)] text-3xl md:text-4xl lg:text-5xl text-white">
            Een concert bij jou thuis
          </h2>
          <blockquote class="mt-6 text-lg text-white/70 italic border-l-4 border-[var(--color-gold)] pl-6">
            &ldquo;Alsof je een avond bij een vriend zit die toevallig prachtig kan zingen.&rdquo;
          </blockquote>
          <p class="mt-6 text-base text-white/60">
            Geschikt voor 20 tot 80 personen. Een intieme avond vol eigen songs, covers en verhalen. Ik neem mijn gitaar mee en doe de rest.
          </p>
          <div class="mt-8 flex flex-wrap gap-4">
            <Button href="https://boeken.edstruijlaart.nl" variant="primary" size="lg">
              Boek een huiskamerconcert
            </Button>
            <a
              href="/huiskamerconcerten/"
              class="inline-flex items-center gap-2 px-6 py-3 rounded-full font-medium text-base border-2 border-white/30 text-white hover:border-white/60 hover:bg-white/5 transition-all duration-300"
            >
              Meer informatie
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
