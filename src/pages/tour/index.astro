---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SectionHeading from '../../components/ui/SectionHeading.astro';
import ShowList from '../../components/sections/ShowList.astro';
import Button from '../../components/ui/Button.astro';
import { Image } from 'astro:assets';
import { tours } from '../../data/tours';

// Import theater posters
const posterImages = import.meta.glob<{ default: ImageMetadata }>('../../assets/theater/*.{jpg,jpeg,png}', { eager: true });

function getPosterImage(filename: string): ImageMetadata | undefined {
  const key = Object.keys(posterImages).find(k => k.endsWith(filename));
  return key ? posterImages[key].default : undefined;
}

const currentTour = tours.find(t => t.current);
const archivedTours = tours.filter(t => !t.current);
---

<BaseLayout
  title="Theater & Shows"
  description="Bekijk de agenda van Ed Struijlaart. Theatershow Gitaarmannen 3: John Mayer, huiskamerconcerten en meer."
>
  <!-- Poster Gallery Hero -->
  <section class="py-24 lg:py-32">
    <div class="mx-auto max-w-[1200px] px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h1 class="font-[var(--font-display)] text-4xl lg:text-5xl">Theater</h1>
        <p class="mt-4 text-lg text-[var(--fg-muted)] max-w-2xl mx-auto">
          Vier theaterproducties, meer dan 180 voorstellingen door heel Nederland.
        </p>
      </div>

      <!-- Poster Grid -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8">
        {tours.map(tour => {
          const poster = getPosterImage(tour.posterImage);
          return (
            <a
              href={`/tour/${tour.slug}/`}
              class="group block"
            >
              {/* Poster */}
              <div class="relative rounded-lg overflow-hidden" style="box-shadow: var(--shadow-card);">
                {poster && (
                  <div class="aspect-[3/4] overflow-hidden">
                    <Image
                      src={poster}
                      alt={`${tour.title}${tour.subtitle ? ': ' + tour.subtitle : ''} theaterposter`}
                      width={400}
                      height={533}
                      class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                      loading="eager"
                    />
                  </div>
                )}
                {/* Current badge */}
                {tour.current && (
                  <div class="absolute top-3 right-3">
                    <span class="inline-block px-2 py-1 rounded-full text-xs font-medium bg-[var(--color-gold)] text-white shadow-lg">
                      Nu in theater
                    </span>
                  </div>
                )}
              </div>
              {/* Title + year below poster */}
              <div class="mt-3 text-center">
                <p class="font-[var(--font-display)] text-base sm:text-lg group-hover:text-[var(--color-gold)] transition-colors duration-300">
                  {tour.title}{tour.subtitle ? `: ${tour.subtitle}` : ''}
                </p>
                <p class="text-sm text-[var(--fg-muted)] mt-0.5">{tour.year}</p>
              </div>
            </a>
          );
        })}
      </div>
    </div>
  </section>

  <!-- Huidige productie detail -->
  {currentTour && (() => {
    const poster = getPosterImage(currentTour.posterImage);
    return (
      <section class="py-24" style="background-color: var(--bg-surface);">
        <div class="mx-auto max-w-[1200px] px-4 sm:px-6 lg:px-8">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
            {poster && (
              <div class="rounded-lg overflow-hidden lg:hidden" style="box-shadow: var(--shadow-card);">
                <Image
                  src={poster}
                  alt={`${currentTour.title}${currentTour.subtitle ? ': ' + currentTour.subtitle : ''} theaterposter`}
                  width={540}
                  class="w-full h-auto"
                  loading="lazy"
                />
              </div>
            )}
            <div>
              <span class="inline-block px-3 py-1 rounded-full text-sm font-medium bg-[var(--color-gold)]/10 text-[var(--color-gold)] mb-4">
                Nu in het theater
              </span>
              <h2 class="font-[var(--font-display)] text-3xl lg:text-4xl">
                {currentTour.title}
              </h2>
              {currentTour.subtitle && (
                <p class="mt-2 font-[var(--font-display)] text-xl text-[var(--color-gold)]">
                  {currentTour.subtitle}
                </p>
              )}
              <p class="mt-4 text-lg text-[var(--fg-muted)] leading-relaxed">
                {currentTour.shortDescription}
              </p>
              {currentTour.credits && (
                <p class="mt-3 text-sm text-[var(--fg-muted)] italic">{currentTour.credits}</p>
              )}
              <div class="mt-8 flex flex-wrap gap-4">
                <Button href={`/tour/${currentTour.slug}/`} variant="primary">
                  Meer over deze voorstelling
                </Button>
                <Button href="#agenda" variant="outline">
                  Bekijk agenda
                </Button>
              </div>
            </div>
          </div>
        </div>
      </section>
    );
  })()}

  <!-- Agenda -->
  <section id="agenda" class="py-24">
    <div class="mx-auto max-w-[1200px] px-4 sm:px-6 lg:px-8">
      <SectionHeading title="Agenda" subtitle="Aankomende shows en optredens" />
      <ShowList />
    </div>
  </section>

  <!-- Huiskamerconcerten -->
  <section class="py-24" style="background-color: var(--bg-surface);">
    <div class="mx-auto max-w-[1200px] px-4 sm:px-6 lg:px-8 text-center">
      <SectionHeading
        title="Huiskamerconcerten"
        subtitle="Een intieme avond met Ed Struijlaart bij jou thuis"
      />
      <p class="text-lg text-[var(--fg-muted)] max-w-2xl mx-auto">
        Boek Ed voor een huiskamerconcert. Eigen songs, covers en verhalen in een intieme setting.
        Geschikt voor 20 tot 80 personen. Neem contact op voor beschikbaarheid en prijzen.
      </p>
      <div class="mt-8">
        <Button href="https://boeken.edstruijlaart.nl" variant="primary" size="lg">
          Boek een huiskamerconcert
        </Button>
      </div>
    </div>
  </section>
</BaseLayout>
