---
import Card from '../ui/Card.astro';
import Button from '../ui/Button.astro';
import { getCollection } from 'astro:content';

interface Props {
  limit?: number;
  showMore?: boolean;
}

const { limit = 3, showMore = true } = Astro.props;

// Get all news posts from markdown content collection
const allPosts = await getCollection('news');

// Sort by date (newest first), posts without date go to the end
const sortedPosts = allPosts.sort((a, b) => {
  const dateA = a.data.date ? new Date(a.data.date).getTime() : 0;
  const dateB = b.data.date ? new Date(b.data.date).getTime() : 0;
  return dateB - dateA;
});

const displayPosts = sortedPosts.slice(0, limit);

// Format date helper
function formatDate(dateStr?: string): string {
  if (!dateStr) return '';
  try {
    const d = new Date(dateStr);
    if (isNaN(d.getTime())) return '';
    return d.toLocaleDateString('nl-NL', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    });
  } catch {
    return '';
  }
}
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
  {displayPosts.map(post => (
    <Card
      title={post.data.title}
      description={post.data.excerpt || ''}
      date={formatDate(post.data.date)}
      href={`/news/${post.data.slug}/`}
      tag="Nieuws"
    />
  ))}
</div>

{showMore && (
  <div class="mt-8 text-center">
    <Button href="/blog/" variant="ghost">
      Alle berichten â†’
    </Button>
  </div>
)}
