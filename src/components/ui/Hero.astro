---
import { Image } from 'astro:assets';

interface Props {
  title: string;
  subtitle?: string;
  tagline?: string;
  images?: ImageMetadata[];
  image?: ImageMetadata;
  imageAlt?: string;
  height?: 'full' | 'large' | 'medium';
  ctaPrimary?: { label: string; href: string };
  ctaSecondary?: { label: string; href: string };
}

const {
  title,
  subtitle,
  tagline,
  images,
  image,
  imageAlt = 'Ed Struijlaart',
  height = 'large',
  ctaPrimary,
  ctaSecondary,
} = Astro.props;

const heightClasses: Record<string, string> = {
  full: 'min-h-screen',
  large: 'min-h-[85vh]',
  medium: 'min-h-[50vh]',
};

// Support both single image and multiple images
const heroImages = images && images.length > 0 ? images : image ? [image] : [];
const hasMultipleImages = heroImages.length > 1;
---

<section class:list={['hero-section relative flex items-end overflow-hidden', heightClasses[height]]}>
  {/* Background images */}
  {heroImages.map((img, i) => (
    <div
      class:list={[
        'hero-slide absolute inset-0 w-full h-full transition-opacity duration-1000',
        i === 0 ? 'opacity-100' : 'opacity-0',
      ]}
      data-slide-index={i}
    >
      <Image
        src={img}
        alt={`${imageAlt}${heroImages.length > 1 ? ` ${i + 1}` : ''}`}
        widths={[640, 1024, 1920]}
        sizes="100vw"
        class="w-full h-full object-cover"
        loading={i === 0 ? "eager" : "lazy"}
        fetchpriority={i === 0 ? "high" : undefined}
      />
    </div>
  ))}

  {/* Gradient overlay — stronger at bottom for text readability */}
  <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent" />

  {/* Content — aligned to bottom */}
  <div class="relative z-10 w-full px-4 sm:px-6 lg:px-8 pb-16 md:pb-20 lg:pb-24 max-w-[1200px] mx-auto">
    {tagline && (
      <p class="text-[var(--color-gold)] text-sm font-medium uppercase tracking-widest mb-4">
        {tagline}
      </p>
    )}
    <h1 class="font-[var(--font-display)] text-4xl sm:text-5xl md:text-6xl lg:text-7xl text-white leading-tight max-w-3xl">
      {title}
    </h1>
    {subtitle && (
      <p class="mt-4 text-base sm:text-lg md:text-xl text-white/80 tracking-wide">
        {subtitle}
      </p>
    )}
    {(ctaPrimary || ctaSecondary) && (
      <div class="mt-8 flex flex-wrap gap-4">
        {ctaPrimary && (
          <a
            href={ctaPrimary.href}
            class="inline-flex items-center gap-2 px-6 py-3 rounded-full font-medium text-base bg-[var(--color-gold)] text-white hover:bg-[var(--color-gold-light)] transition-colors duration-300"
          >
            {ctaPrimary.label}
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
          </a>
        )}
        {ctaSecondary && (
          <a
            href={ctaSecondary.href}
            class="inline-flex items-center gap-2 px-6 py-3 rounded-full font-medium text-base border-2 border-white/40 text-white hover:border-white hover:bg-white/10 transition-all duration-300"
          >
            {ctaSecondary.label}
          </a>
        )}
      </div>
    )}
    <slot />
  </div>

  {/* Slide indicators */}
  {hasMultipleImages && (
    <div class="absolute bottom-6 right-8 z-20 flex gap-2" aria-label="Foto navigatie">
      {heroImages.map((_, i) => (
        <button
          class:list={[
            'hero-dot w-2 h-2 rounded-full transition-all duration-300',
            i === 0 ? 'bg-white w-6' : 'bg-white/50',
          ]}
          data-dot-index={i}
          aria-label={`Foto ${i + 1}`}
        />
      ))}
    </div>
  )}
</section>

{hasMultipleImages && (
  <script>
    function initHeroSlider() {
      const slides = document.querySelectorAll<HTMLElement>('.hero-slide');
      const dots = document.querySelectorAll<HTMLElement>('.hero-dot');
      if (slides.length <= 1) return;

      let current = 0;
      const total = slides.length;

      function goTo(index: number) {
        slides[current].classList.remove('opacity-100');
        slides[current].classList.add('opacity-0');
        dots[current].classList.remove('bg-white', 'w-6');
        dots[current].classList.add('bg-white/50');

        current = index;

        slides[current].classList.remove('opacity-0');
        slides[current].classList.add('opacity-100');
        dots[current].classList.remove('bg-white/50');
        dots[current].classList.add('bg-white', 'w-6');
      }

      // Auto-advance every 6 seconds
      let timer = setInterval(() => goTo((current + 1) % total), 6000);

      // Click dots to navigate
      dots.forEach((dot, i) => {
        dot.addEventListener('click', () => {
          clearInterval(timer);
          goTo(i);
          timer = setInterval(() => goTo((current + 1) % total), 6000);
        });
      });
    }

    initHeroSlider();
    document.addEventListener('astro:after-swap', initHeroSlider);
  </script>
)}
